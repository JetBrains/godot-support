# Contribution

Hello, thanks for taking time and helping out with the plugin!

Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. Please sign the CLA before sending the PR: https://www.jetbrains.com/agreements/cla/.

#### [Local setup](documentation%2Fcontribution%2Flocal_setup.md)

## Tutorials

You can first start with official tutorials - they are very minimalistic so not that long read.  
[Explanations](https://plugins.jetbrains.com/docs/intellij/syntax-highlighting-and-error-highlighting.html)  
[Code examples](https://plugins.jetbrains.com/docs/intellij/syntax-highlighter-and-color-settings-page.html)  
You don't have to read it all, but at least check if there's a chapter for a feature you want to work with.

## Development

[Souce code](documentation%2Fcontribution%2Fsouce_code.md)  
[Code flow overview](documentation%2Fcontribution%2Fcode_flow.md)

#### Features

...I don't know what to write there... if you'd jump into development I'd say just get in touch with me and I can help you out... and fill in this part. If you have any questions, please open a GitHub issue in this repository: https://github.com/JetBrains/godot-support/issues

Maybe write there how to approach different features? But I'd start with tutorials mentioned above.

#### Testing
- [tests.md](documentation/contribution/tests.md)

## Important notes

### Debugging

IDEa when running is constantly checking for ProcessCancellation to prevent freezing (cannot prevent it when my own code is freezing - sorry), which means that while debugging you have maybe 1 or 2 seconds, before processes is killed.  

You can turn it off under `Tools | Internal Actions | Skip Window Deactivation Events` since 2023.2 or read [official doc](https://plugins.jetbrains.com/docs/intellij/general-threading-rules.html#disabling-processcanceledexception) if changed.

!! IMPORTANT !! Turn it off in debug editor started from gradle :runIde NOT in the one that you are using for development.

### gd.bnf grammar

This is outdated and no longer in use - the same goes for GdParser.java within `src/gen/` folder that is generated by it.

Whole Parser is rewritten into pure .kt files under `src/gdscript/parser/` the reason is that Godot is ContextAware language which bnf does not support.

On the same note, classes inside `src/gen/gdscript/psi/` are obsolete - they are still used as they have been generated from .bnf (it'd be too much work to move and update them), but should there be any change to Psi, .bnf generators cannot be used anymore, thus it's important to edit those files - preferably to also move them inside `src/kotlin/gdscript/psi/` when editing them.

.tscn and .godot parsers are still using their .bnf grammars

## Quirks

- Java code  
Most of the code is already rewritten in Kotlin, but there are still few Java files - which are due to legacy/bug reasons, like some files I was unable to transfer to Kotlin as it just stopped working... after a little while I stopped caring and never returned it to.


- Php code  
under `php` folder are few Php files - those are generators used for SDK generation (parsing Godot's source .xml into plugin's .gd)
and 2 .gdconf files used for checking Annotations and Operations (like if you can sum String with Int and what resulting type would be)


- Makefile  
This is used for copying Godot's icons to have same visuals for completion of Classes, line markers and so on.  
Later may be added into CI to update it with each new Godot release


## Pull Request Checklist

When submitting a PR, please ensure the following:

- The fix or feature implementation is included in the PR.
- Tests are added or updated as described in - [tests.md](documentation/contribution/tests.md)
- Optional: A YouTrack issue is linked (https://youtrack.jetbrains.com/issues) to keep QA and release notes in the loop.
  - If the commit that contains the fix starts with "fix Rider-XXX", automation will mark it fixed and set the proper "fixed in build" when the change is synced to the main Rider repository.

You can also follow the prompts in our GitHub pull request template located at .github/pull_request_template.md.
